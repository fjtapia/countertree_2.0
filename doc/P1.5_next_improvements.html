<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
    <meta name="generator" content="HTML Tidy for Windows (vers 1st November 2003), see www.w3.org" />
    <title>Boost C++ Libraries</title>
    <link rel="icon" href="http://www.boost.org/favicon.ico" type="image/ico" />
    <link rel="stylesheet" type="text/css" href="http://www.boost.org/style-v2/section-welcome.css" />
    <link href="files/code.css" type="text/css" rel="stylesheet" />
    <!--[if IE 7]> <style type="text/css"> body { behavior: url(http://www.boost.org/style-v2/csshover3.htc); } </style> <![endif]-->
    <meta name="google-site-verification" content="mpr2HgFpodnbF_8fv4qXd9roIClVwtX3C-Kd3F6r61w" />
  </head>
  <!-- Note: Editing website content is documented at:http://www.boost.org/development/website_updating.html-->
  <!--***************************************************************************************** -->
  <!--                                        B O D Y                                           -->
  <!--***************************************************************************************** -->
  <body>
    <div id="heading">
      <div class="heading-inner">
        <h1 class="heading-title"> <a href="http://www.boost.org/"> <img src="http://www.boost.org//gfx/space.png"
              alt="Boost C++ Libraries" class="heading-logo" /> <span class="heading-boost">Boost</span>
            <span class="heading-cpplibraries">C++ Libraries</span> <img src="img/preliminary.gif"
              alt="Preliminary" style="width: 300px; height: 80px;" /> </a></h1>
        <p class="heading-quote"> <q>...one of the most highly regarded and
            expertly designed C++ library projects in the world.</q> <span class="heading-attribution">—
            <a href="http://www.gotw.ca/" class="external">Herb Sutter</a> and <a
              href="http://en.wikipedia.org/wiki/Andrei_Alexandrescu" class="external">Andrei
              Alexandrescu</a>, <a href="http://safari.awprofessional.com/?XmlId=0321113586"
              class="external">C++ Coding Standards</a></span></p>
      </div>
    </div>
    <div class="clear"> </div>
    <div class="cuerpo_central"> <br />
      <div class="cuerpo_texto"> <br />
        <br />
        <span style="font-size: 24pt;"> <span style="font-weight: bold; color: black;">
            <a href="index.html">The [ Counter Tree + Suballocator ] Library</a>
          </span></span><br />
        <div>
          <div class="author">
            <h3 class="author"><br />
              <span class="firstname"></span></h3>
            <h3 style="font-size: 10pt; font-style: italic; font-weight: bold" class="author">
              <span style="font-weight: bold;"><span class="firstname" style="font-weight: bold;">Francisco
                  Jose Tapia</span>   Copyright © 2010-2013 Francisco Jose Tapia</span></h3>
          </div>
        </div>
        <div class="legalnotice">
          <p><span style="font-size: 10pt; font-style: italic; font-weight: bold">Distributed
              under the Boost Software License, Version 1.0. (See accompanying
              file LICENSE_1_0.txt or copy at <a href="file:///LICENSE_1_0.txt"
                target="_top"> http://www.boost.org/LICENSE_1_0.txt )</a></span>
          </p>
        </div>
        <br />
        <br />
        <!--***************************************************************************************** -->
        <!--                                        M E N U                                           -->
        <!--***************************************************************************************** -->
        <div class="caja_menu"> <span style="font-size: 16pt; color: black;"><br />
            Table of Contents</span> <br />
          <div style="margin-left: 40px;">
            <div style="margin-left: 40px;"> <a href="P1.0_introduction.html#introduction">1.-
                Introduction</a><br />
              <div style="margin-left: 40px;"><a href="P1.0_introduction.html#countertree">1.1.-
                  Description of the Counter Trees</a><br />
                <div style="margin-left: 40px;"><a href="P1.0_introduction.html#iterators">1.1.1.-
                    Iterators</a></div>
                <a href="P1.2_description_suballocators.html#suballocator">1.2.-
                  Description of the Suballocators </a><br />
                <a href="P1.2_description_suballocators.html#countertree_suballocator">1.3.-
                  Description of Counter Trees + Suballocators </a><br />
                <a href="P1.4_concurrent_versions.html#concurrent">1.4.-
                  Concurrent version</a><br />
                <div style="margin-left: 40px;"><a href="P1.4_concurrent_versions.html#lock">1.4.1.-
                    Lock description</a><br />
                </div>
                <div style="margin-left: 40px;"><a href="P1.4_concurrent_versions.html#description">1.4.2.-
                    Description of the class of the library</a><br />
                  <a href="P1.4_concurrent_versions.html#problems">1.4.3.-
                    Problems associated to the concurrency. Solutions
                    implemented</a><br />
                  <a href="P1.4_concurrent_versions.html#deletion">1.4.4.-
                    Access by position and deletion in the first/last position</a></div>
                <a href="P1.5_next_improvements.html#next_improvements">1.5.-
                  Next Improvements</a><br />
                <div style="margin-left: 40px;"><a href="P1.5_next_improvements.html#parallel">1.5.1-
                    Parallel design of copy and clear trees ,logical functions
                    with trees and several functions of &lt;algorithm&gt;</a><br />
                  <a href="P1.5_next_improvements.html#redesign">1.5.2- Redesign
                    of the internal algorithm</a><br />
                  <a href="P1.5_next_improvements.html#augmented">1.5.3-
                    Augmented trees</a></div>
                <br />
                <br />
                <br />
              </div>
            </div>
          </div>
        </div>
        <br />
        <br />
        <p><a name="next_improvements"></a> <span style="font-size: 16pt;font-weight: bold; color: black;">1.5.-
            Next improvements</span></p>
        <p class="cuerpo_texto"> <br />
        </p>
        This is a long term project with 6 steps. The first 3  are done <br />
        <br />
        <div style="margin-left: 40px;">
          <ol>
            <li>Design and implementation of the countertree</li>
            <li>Design and implementation of suballocator</li>
            <li>Concurrent version of countertree and suballocator</li>
            <li>Design and implementation of parallel functions of the class(
              copy and clear), parallel fast logic functions (union,
              intersection, nor intersection) with trees,, and design and
              implementation of several parallel functions of &lt;algorithms&gt;</li>
            <li>Redesign the internal algorithm.</li>
            <li> Augmented trees</li>
          </ol>
        </div>
        <br />
        The next steps are :<br />
        <br />
        <p><a name="parallel"></a> <span style="font-size: 16pt;font-weight: bold; color: black;">1.5.1.-
            Parallel design of functions of the trees (copy, clear), logical
            functions with trees (union, intersection, not intersection) and 
            several functions of &lt;algorithm&gt;</span></p>
        <br />
        The next step is design parallel functions for the class. Some functions
        of the class, when the tree is big, are time expensive, like the copy (
        used in the copy constructor and in the operator =) and the clear of the
        tree ( used in the clear function and in the destructor). The use of
        parallel algorithms for these functions cut the time needed.<br />
        <br />
        Many times the maps are used as index. When make a search in the map,
        obtain a set of keys. In the selection process you must combine several
        sets of keys with logical functions ( union, intersection,
        not-intersection....). Many times these set are very large, the time and
        the memory used too, like in the map-reduce systems. The <span style="font-weight: bold;">map
          reduce system</span> are the heart of the <span style="font-weight: bold;">Big
          Data applications</span>. With the random-access iterators is easy to
        make these functions parallel. The idea is to create a rich set of
        parallel fast logical functions in order to simplify the process, reduce
        the memory used in the process and cut the time needed with the
        concurrent process.<br />
        <br />
        With the random access iterators, it is easy to design parallel
        algorithms for many functions of &lt;algorithm&gt;, like for_each,
        count, count_if ....... You can find examples of parallel functions in
        the vector_tree ( <a href="P2.3_vector_tree_examples.html" title="vector_tree examples">2.3.-
          Examples</a>) and in the set map  ( <a href="P3.6_set_map_examples.html"
          title="set map examples">3.6.- Examples</a> )<br />
        <br />
        These new functions need an additional parameter indicating the number
        of threads used in the process. The value 0 indicate  the number of
        thread used  is the number of cores of the processor.<br />
        <br />
        The benchmark for  the set concurrent (
        benchmark_set_intersection_cnc.cpp ) is a parallel version of the
        function set_intersection compared with a single core function and the
        function defined in &lt;algorithm&gt;. ( You can find it in the folder
        benchmark of the file <a href="countertree_2.0.zip" title="countertree_2.0.zip">countertree_2.0.zip</a>
        )<br />
        <br />
        I have the design on paper of the parallel algorithms of copy, clear,
        the logical functions( union, intersection, not-intersection) and many
        functions included in &lt;algorithm&gt;<br />
        <br />
        <br />
        <p><a name="redesign"></a> <span style="font-size: 16pt;font-weight: bold; color: black;">1.5.2.-
            Redesign of the internal algorithm</span></p>
        <br />
        When you design a <span class="il">tree</span>, you must develop a
        balanced algorithm in order to prevent a degenerate <span class="il">tree</span>
        ( <span class="il">Tree</span> like a linked list). You have several
        types of balanced trees ( mainly Red-Black and <span>AVL</span> ). 
        That decision about the type of balance tree  have influence on the
        quality of the balance and the speed of the <span class="il">tree</span>.
        The most used are the red-black trees. You have an excellent description
        with code in <span style="font-style: italic;">“Introduction to
          Algorithms”</span> ( Cormen , Leiserson, Rivest). <br />
        <img align="middle" style="border: 25px solid white;" alt="red-black balancing"
          src="img/balanceo.png" />
        <p style="margin-bottom:0in">But , even the same type of balance tree,
          ,it  can be done in several ways,</p>
        <p style="margin-bottom:0in"><br />
        </p>
        <p style="margin-bottom:0in">In order to design an algorithm for to
          insert, delete and balance a red-black tree you must take care about</p>
        <p style="margin-bottom: 0in; margin-left: 40px;">1.- What of the
          solutions do you want </p>
        <div style="margin-left: 40px;"> </div>
        <p style="margin-bottom: 0in; margin-left: 40px;">2.- How do you define
          the rules, which applying obtain the desired solution.</p>
        <div style="margin-left: 40px;"> </div>
        <p style="margin-bottom: 0in; margin-left: 40px;">3.- What's the cost in
          time of process .</p>
        <div style="margin-left: 40px;"> </div>
        <p style="margin-bottom: 0in; margin-left: 40px;">4.- Benefits,
          advantage  of this solution respect the others </p>
        <br />
        <p style="margin-bottom:0in">When I decided add the <span class="il">counter</span>
          to the nodes for the design of the <span><span class="il">CounterTree</span></span>,
          I tried to use the code showed in "Introduction to algorithms", but
          was very complex the management of  the counters, and decide design my
          own balanced algorithm based on the 234Tree description. The result is
          the actual version of <span><span class="il">CounterTree</span></span>.
          It is 10% more or less slower than the <span>GCC</span>
          implementation, but is logic , because must manage the pointers and
          the counters.</p>
        <p style="margin-bottom:0in"><br />
        </p>
        It's only a first version. I am convinced, this algorithm can be
        improved in the design and in the implementation, Looking for a way for
        to improve the speed , I examined others implementations of Red-Black
        trees, several books an mainly with the experience obtained with the <span>Suballocator</span>.
        I decided to change several things of the algorithm and the
        implementation, pursuing to improve the speed. I have a first design
        done on paper.<br />
        <br />
        Some parallel functions of the tree, described in the previous point,
        with a big number of threads can appear bottleneck effects. The redesign
        of several algorithms using techniques of split and join the tree,
        permit to be used by hundreds of threads without bottleneck effects.
        This technique permit to make parallel functions didn't done previously.
        The redesign of the algorithm must provide the split and join trees
        functions, which permit to redesign several functions of the trees in
        order to be efficient in a manycore system.<br />
        <br />
        The new algorithm must provide a low level catalog of operations with
        the nodes. ( insert, delete , rotations, swap... ) in order to provide
        support to the next point,  the <span style="font-weight: bold;">AUGMENTED
          TREES</span><br />
        <br />
        <br />
        <p><a name="augmented"></a> <span style="font-size: 16pt;font-weight: bold; color: black;">1.5.3.-
            Augmented trees<br />
          </span></p>
        <br />
        The augmented trees are trees with additional information, which is not
        fixed. It must be processed and changed when you insert, delete or move
        an node in the tree.<br />
        The augmented trees have  in each node a data not fixed( augmented
        data). This data depend of the node and others node of the tree ( their
        data, position, number of them  ...). Due this, each change, insertion,
        deletion or movement, generates changes in the augmented information in
        all the nodes related.<br />
        <br />
        <img src="img/augmented_1.jpg" alt="interval tree" /><br />
        <br />
        This is an interval tree. The tree is ordered by the lower value of the
        fixed information. The augmented information represent the interval of
        the node and all the nodes under it including itself.<br />
        <br />
        <img src="img/augmented_2.jpg" alt="accumulator tree" /><br />
        <br />
        This tree is unordered ( The unordered trees are vector_tree). The
        augmented information  represent the addition of the augmented
        information of the nodes under it , plus its fixed information.<br />
        <br />
        <img src="img/ctree_02.png" alt="countertree" /><br />
        <br />
        The countertrees are augmented trees. The fixed information don't exist,
        and the augmented information represent the number of nudes under it.
        Every time you  insert, delete or move a  node in the tree, this
        information must be recalculate. <br />
        <br />
        You can find augmented trees with a wide variety of informations in
        areas from the statistical or games, to the biology. Even you can find
        trees with several augmented informations simoultaneously<br />
        <br />
        For the speed the best solution is to include the information and the
        process inside the <span class="il">tree</span>. With this, you
        customize your <span class="il">tree</span> and obtain the maximum
        speed.<br />
        <br />
        In the new version of the algorithm, all the internal process of the <span
          class="il">tree</span> can be decomposed in a set of small operations
        of a “catalog” like:<br />
        <br />
        <div style="margin-left: 40px;">
          <ul>
            <li>Insert/delete a node in the right/left pointer of a node.</li>
            <li>All the rotations with nodes</li>
            <li>Swap of nodes directly linked and not directly linked</li>
            <li>Design the information to insert in the node</li>
          </ul>
        </div>
        <br />
        When you want have an augmented tree, you must codify, what must do with
        your augmented information in each operation of the "catalog" . When the
        tree execute its the code of each operation , execute also the code of
        the same operation of your augmented information.<br />
        <br />
        You can have augmented trees by several concepts simultaneously. Each
        concept have codified the code of all the operations of the catalog. And
        then when the tree execute the code of the operation, execute too the
        code of all the augmented information of the tree.<br />
        <br />
        You have compiled augmented trees, balanced, robust and with the maximal
        speed, and with all the benefits of the countertrees, concurrent and,
        thread-safe operations, access by position, use of suballocators....<br />
      </div>
      <br />
      <a style="float:right" href="P2.0_vector_tree.html" title="vector_tree"><img
          src="img/next.png" alt="link to unordered page" /></a> <a style="float:right"
        href="P1.0_introduction.html" title="introduction"><img src="img/up.png"
          alt="go to head of the page" /></a> <a style="float:right" href="P1.4_concurrent_versions.html"
        title="concurrent"><img alt="previous page" src="img/prev.png" /></a> <a
        style="float:right" href="index.html" title="index.html"><img alt="home page"
          src="img/home.png" /></a> <br />
      <table width="100%" xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision">
        <tbody>
          <tr>
            <td align="left">
              <p><small>Last revised: September  30, 2012 at 21:42:41 GMT</small></p>
            </td>
            <td align="right"> <br />
            </td>
          </tr>
        </tbody>
      </table>
      <hr />
      <div id="footer">
        <div id="footer-left">
          <div id="copyright">
            <p>Copyright Francisco Jose Tapia 2010-2012.</p>
          </div>
          <div id="license">
            <p>Distributed under the <a href="/LICENSE_1_0.txt" class="internal">Boost
                Software License, Version 1.0</a>.</p>
          </div>
        </div>
        <div id="footer-right">
          <div id="banners">
            <p id="banner-xhtml"> <a href="http://validator.w3.org/check?uri=referer"
                class="external">XHTML 1.0</a></p>
            <p id="banner-css"> <a href="http://jigsaw.w3.org/css-validator/check/referer"
                class="external">CSS</a></p>
            <p id="banner-osi"> <a href="http://www.opensource.org/docs/definition.php"
                class="external">OSI Certified</a></p>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
